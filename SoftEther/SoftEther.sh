#!/bin/bash
# Author: MoeClub.org

export ADMIN=''
export USER=''
export PASSWD=''
export SoftEtherURL=''
export SoftEtherVersion='v4.38-9760-rtm-2021.08.17'
export SoftEtherConfig='77u/IyBTb2Z0d2FyZSBDb25maWd1cmF0aW9uIEZpbGUNCiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQojIA0KIyBZb3UgbWF5IGVkaXQgdGhpcyBmaWxlIHdoZW4gdGhlIFZQTiBTZXJ2ZXIgLyBDbGllbnQgLyBCcmlkZ2UgcHJvZ3JhbSBpcyBub3QgcnVubmluZy4NCiMgDQojIEluIHByaW9yIHRvIGVkaXQgdGhpcyBmaWxlIG1hbnVhbGx5IGJ5IHlvdXIgdGV4dCBlZGl0b3IsDQojIHNodXRkb3duIHRoZSBWUE4gU2VydmVyIC8gQ2xpZW50IC8gQnJpZGdlIGJhY2tncm91bmQgc2VydmljZS4NCiMgT3RoZXJ3aXNlLCBhbGwgY2hhbmdlcyB3aWxsIGJlIGxvc3QuDQojIA0KZGVjbGFyZSByb290DQp7DQoJdWludCBDb25maWdSZXZpc2lvbiAwDQoJYm9vbCBJUHNlY01lc3NhZ2VEaXNwbGF5ZWQgdHJ1ZQ0KCXN0cmluZyBSZWdpb24gJA0KCWJvb2wgVmdzTWVzc2FnZURpc3BsYXllZCBmYWxzZQ0KDQoJZGVjbGFyZSBERG5zQ2xpZW50DQoJew0KCQlib29sIERpc2FibGVkIHRydWUNCgl9DQoJZGVjbGFyZSBJUHNlYw0KCXsNCgkJYm9vbCBFdGhlcklQX0lQc2VjIGZhbHNlDQoJCXN0cmluZyBJUHNlY19TZWNyZXQgdnBuDQoJCXN0cmluZyBMMlRQX0RlZmF1bHRIdWIgREVGQVVMVA0KCQlib29sIEwyVFBfSVBzZWMgZmFsc2UNCgkJYm9vbCBMMlRQX1JhdyBmYWxzZQ0KDQoJCWRlY2xhcmUgRXRoZXJJUF9JRFNldHRpbmdzTGlzdA0KCQl7DQoJCX0NCgl9DQoJZGVjbGFyZSBMaXN0ZW5lckxpc3QNCgl7DQoJCWRlY2xhcmUgTGlzdGVuZXIwDQoJCXsNCgkJCWJvb2wgRGlzYWJsZURvcyBmYWxzZQ0KCQkJYm9vbCBFbmFibGVkIHRydWUNCgkJCXVpbnQgUG9ydCA1NTU1DQoJCX0NCgl9DQoJZGVjbGFyZSBMb2NhbEJyaWRnZUxpc3QNCgl7DQoJCWJvb2wgRG9Ob3REaXNhYmxlT2ZmbG9hZGluZyBmYWxzZQ0KCX0NCglkZWNsYXJlIFNlcnZlckNvbmZpZ3VyYXRpb24NCgl7DQoJCWJvb2wgQWNjZXB0T25seVRscyB0cnVlDQoJCXVpbnQ2NCBBdXRvRGVsZXRlQ2hlY2tEaXNrRnJlZVNwYWNlTWluIDEwNDg1NzYwMA0KCQl1aW50IEF1dG9EZWxldGVDaGVja0ludGVydmFsU2VjcyAzMDANCgkJdWludCBBdXRvU2F2ZUNvbmZpZ1NwYW4gMzAwDQoJCWJvb2wgQmFja3VwQ29uZmlnT25seVdoZW5Nb2RpZmllZCBmYWxzZQ0KCQlzdHJpbmcgQ2lwaGVyTmFtZSBBRVMxMjgtR0NNLVNIQTI1Ng0KCQlib29sIERpc2FibGVDb3JlRHVtcE9uVW5peCBmYWxzZQ0KCQlib29sIERpc2FibGVEZWFkTG9ja0NoZWNrIGZhbHNlDQoJCWJvb2wgRGlzYWJsZURvc1Byb2N0aW9uIGZhbHNlDQoJCWJvb2wgRGlzYWJsZUdldEhvc3ROYW1lV2hlbkFjY2VwdFRjcCBmYWxzZQ0KCQlib29sIERpc2FibGVJbnRlbEFlc0FjY2VsZXJhdGlvbiBmYWxzZQ0KCQlib29sIERpc2FibGVJUHNlY0FnZ3Jlc3NpdmVNb2RlIGZhbHNlDQoJCWJvb2wgRGlzYWJsZUlQdjZMaXN0ZW5lciB0cnVlDQoJCWJvb2wgRGlzYWJsZUpzb25ScGNXZWJBcGkgdHJ1ZQ0KCQlib29sIERpc2FibGVOYXRUcmF2ZXJzYWwgZmFsc2UNCgkJYm9vbCBEaXNhYmxlT3BlblZQTlNlcnZlciB0cnVlDQoJCWJvb2wgRGlzYWJsZVNlc3Npb25SZWNvbm5lY3QgZmFsc2UNCgkJYm9vbCBEaXNhYmxlU1NUUFNlcnZlciB0cnVlDQoJCWJvb2wgRG9udEJhY2t1cENvbmZpZyB0cnVlDQoJCWJvb2wgRW5hYmxlVnBuT3ZlckRucyBmYWxzZQ0KCQlib29sIEVuYWJsZVZwbk92ZXJJY21wIGZhbHNlDQoJCWJ5dGUgSGFzaGVkUGFzc3dvcmQgVUdUVkFxYnRKT2JCTzZMQ0phUVp5RWJ5MnBnPQ0KCQlzdHJpbmcgS2VlcENvbm5lY3RIb3N0IDEyNy4wLjAuMQ0KCQl1aW50IEtlZXBDb25uZWN0SW50ZXJ2YWwgNTANCgkJdWludCBLZWVwQ29ubmVjdFBvcnQgODANCgkJdWludCBLZWVwQ29ubmVjdFByb3RvY29sIDENCgkJdWludDY0IExvZ2dlck1heExvZ1NpemUgMTA3Mzc0MTgyMw0KCQl1aW50IE1heENvbmN1cnJlbnREbnNDbGllbnRUaHJlYWRzIDUxMg0KCQl1aW50IE1heENvbm5lY3Rpb25zUGVySVAgMjU2DQoJCXVpbnQgTWF4VW5lc3RhYmxpc2hlZENvbm5lY3Rpb25zIDEwMDANCgkJYm9vbCBOb0hpZ2hQcmlvcml0eVByb2Nlc3MgZmFsc2UNCgkJYm9vbCBOb0xpbnV4QXJwRmlsdGVyIGZhbHNlDQoJCWJvb2wgTm9TZW5kU2lnbmF0dXJlIGZhbHNlDQoJCXN0cmluZyBPcGVuVlBORGVmYXVsdENsaWVudE9wdGlvbiBkZXYtdHlwZSQyMHR1bixsaW5rLW10dSQyMDE1MDAsdHVuLW10dSQyMDE1MDAsY2lwaGVyJDIwQUVTLTEyOC1DQkMsYXV0aCQyMFNIQTEsa2V5c2l6ZSQyMDEyOCxrZXktbWV0aG9kJDIwMix0bHMtY2xpZW50DQoJCXN0cmluZyBPcGVuVlBOX1VkcFBvcnRMaXN0IDExOTQNCgkJYm9vbCBTYXZlRGVidWdMb2cgZmFsc2UNCgkJdWludCBTZXJ2ZXJMb2dTd2l0Y2hUeXBlIDQNCgkJdWludCBTZXJ2ZXJUeXBlIDANCgkJYm9vbCBTdHJpY3RTeXNsb2dEYXRldGltZUZvcm1hdCBmYWxzZQ0KCQlib29sIFRsc19EaXNhYmxlMV8wIGZhbHNlDQoJCWJvb2wgVGxzX0Rpc2FibGUxXzEgZmFsc2UNCgkJYm9vbCBUbHNfRGlzYWJsZTFfMiBmYWxzZQ0KCQlib29sIFRsc19EaXNhYmxlMV8zIGZhbHNlDQoJCWJvb2wgVXNlS2VlcENvbm5lY3QgZmFsc2UNCgkJYm9vbCBVc2VXZWJUaW1lUGFnZSBmYWxzZQ0KCQlib29sIFVzZVdlYlVJIGZhbHNlDQoNCgkJZGVjbGFyZSBHbG9iYWxQYXJhbXMNCgkJew0KCQkJdWludCBGSUZPX0JVREdFVCAxMDI0MDAwMA0KCQkJdWludCBIVUJfQVJQX1NFTkRfSU5URVJWQUwgNTAwMA0KCQkJdWludCBJUF9UQUJMRV9FWFBJUkVfVElNRSA2MDAwMA0KCQkJdWludCBJUF9UQUJMRV9FWFBJUkVfVElNRV9ESENQIDMwMDAwMA0KCQkJdWludCBNQUNfVEFCTEVfRVhQSVJFX1RJTUUgNjAwMDAwDQoJCQl1aW50IE1BWF9CVUZGRVJJTkdfUEFDS0VUX1NJWkUgMjU2MDAwMA0KCQkJdWludCBNQVhfSFVCX0xJTktTIDEwMjQNCgkJCXVpbnQgTUFYX0lQX1RBQkxFUyA2NTUzNg0KCQkJdWludCBNQVhfTUFDX1RBQkxFUyA2NTUzNg0KCQkJdWludCBNQVhfU0VORF9TT0NLRVRfUVVFVUVfTlVNIDEyOA0KCQkJdWludCBNQVhfU0VORF9TT0NLRVRfUVVFVUVfU0laRSAyNTYwMDAwDQoJCQl1aW50IE1BWF9TVE9SRURfUVVFVUVfTlVNIDEwMjQNCgkJCXVpbnQgTUVNX0ZJRk9fUkVBTExPQ19NRU1fU0laRSA2NTUzNjANCgkJCXVpbnQgTUlOX1NFTkRfU09DS0VUX1FVRVVFX1NJWkUgMzIwMDAwDQoJCQl1aW50IFFVRVVFX0JVREdFVCAyMDQ4DQoJCQl1aW50IFNFTEVDVF9USU1FIDI1Ng0KCQkJdWludCBTRUxFQ1RfVElNRV9GT1JfTkFUIDMwDQoJCQl1aW50IFNUT1JNX0NIRUNLX1NQQU4gNTAwDQoJCQl1aW50IFNUT1JNX0RJU0NBUkRfVkFMVUVfRU5EIDEwMjQNCgkJCXVpbnQgU1RPUk1fRElTQ0FSRF9WQUxVRV9TVEFSVCAzDQoJCX0NCgkJZGVjbGFyZSBTZXJ2ZXJUcmFmZmljDQoJCXsNCgkJfQ0KCQlkZWNsYXJlIFN5c2xvZ1NldHRpbmdzDQoJCXsNCgkJCXN0cmluZyBIb3N0TmFtZSAkDQoJCQl1aW50IFBvcnQgNTE0DQoJCQl1aW50IFNhdmVUeXBlIDANCgkJfQ0KCX0NCglkZWNsYXJlIFZpcnR1YWxIVUINCgl7DQoJCWRlY2xhcmUgREVGQVVMVA0KCQl7DQoJCQl1aW50NjQgQ3JlYXRlZFRpbWUgMA0KCQkJYnl0ZSBIYXNoZWRQYXNzd29yZCBVR1RWQXFidEpPYkJPNkxDSmFRWnlFYnkycGc9DQoJCQl1aW50NjQgTGFzdENvbW1UaW1lIDANCgkJCXVpbnQ2NCBMYXN0TG9naW5UaW1lIDANCgkJCXVpbnQgTnVtTG9naW4gMA0KCQkJYm9vbCBPbmxpbmUgdHJ1ZQ0KCQkJYm9vbCBSYWRpdXNDb252ZXJ0QWxsTXNDaGFwdjJBdXRoUmVxdWVzdFRvRWFwIGZhbHNlDQoJCQlzdHJpbmcgUmFkaXVzUmVhbG0gJA0KCQkJdWludCBSYWRpdXNSZXRyeUludGVydmFsIDANCgkJCXVpbnQgUmFkaXVzU2VydmVyUG9ydCAxODEyDQoJCQlzdHJpbmcgUmFkaXVzU3VmZml4RmlsdGVyICQNCgkJCWJvb2wgUmFkaXVzVXNlUGVhcEluc3RlYWRPZkVhcCBmYWxzZQ0KCQkJdWludCBUeXBlIDANCg0KCQkJZGVjbGFyZSBBY2Nlc3NMaXN0DQoJCQl7DQoJCQkJZGVjbGFyZSAxDQoJCQkJew0KCQkJCQlib29sIEFjdGl2ZSB0cnVlDQoJCQkJCWJvb2wgQ2hlY2tEc3RNYWMgZmFsc2UNCgkJCQkJYm9vbCBDaGVja1NyY01hYyBmYWxzZQ0KCQkJCQlib29sIENoZWNrVGNwU3RhdGUgZmFsc2UNCgkJCQkJdWludCBEZWxheSAwDQoJCQkJCXN0cmluZyBEZXN0SXBBZGRyZXNzIDAuMC4wLjANCgkJCQkJdWludCBEZXN0UG9ydEVuZCAwDQoJCQkJCXVpbnQgRGVzdFBvcnRTdGFydCAwDQoJCQkJCXN0cmluZyBEZXN0U3VibmV0TWFzayAwLjAuMC4wDQoJCQkJCXN0cmluZyBEZXN0VXNlcm5hbWUgJA0KCQkJCQlib29sIERpc2NhcmQgZmFsc2UNCgkJCQkJYm9vbCBFc3RhYmxpc2hlZCBmYWxzZQ0KCQkJCQlib29sIElzSVB2NiBmYWxzZQ0KCQkJCQl1aW50IEppdHRlciAwDQoJCQkJCXVpbnQgTG9zcyAwDQoJCQkJCXN0cmluZyBOb3RlICQNCgkJCQkJdWludCBQcmlvcml0eSAxMDAwDQoJCQkJCXVpbnQgUHJvdG9jb2wgMA0KCQkJCQlzdHJpbmcgUmVkaXJlY3RVcmwgJA0KCQkJCQlzdHJpbmcgU3JjSXBBZGRyZXNzIDAuMC4wLjANCgkJCQkJdWludCBTcmNQb3J0RW5kIDANCgkJCQkJdWludCBTcmNQb3J0U3RhcnQgMA0KCQkJCQlzdHJpbmcgU3JjU3VibmV0TWFzayAwLjAuMC4wDQoJCQkJCXN0cmluZyBTcmNVc2VybmFtZSAkDQoJCQkJfQ0KCQkJfQ0KCQkJZGVjbGFyZSBBZG1pbk9wdGlvbg0KCQkJew0KCQkJCXVpbnQgYWxsb3dfaHViX2FkbWluX2NoYW5nZV9vcHRpb24gMA0KCQkJCXVpbnQgZGVueV9icmlkZ2UgMA0KCQkJCXVpbnQgZGVueV9jaGFuZ2VfdXNlcl9wYXNzd29yZCAwDQoJCQkJdWludCBkZW55X2VtcHR5X3Bhc3N3b3JkIDANCgkJCQl1aW50IGRlbnlfaHViX2FkbWluX2NoYW5nZV9leHRfb3B0aW9uIDANCgkJCQl1aW50IGRlbnlfcW9zIDANCgkJCQl1aW50IGRlbnlfcm91dGluZyAwDQoJCQkJdWludCBtYXhfYWNjZXNzbGlzdHMgMA0KCQkJCXVpbnQgbWF4X2JpdHJhdGVzX2Rvd25sb2FkIDANCgkJCQl1aW50IG1heF9iaXRyYXRlc191cGxvYWQgMA0KCQkJCXVpbnQgbWF4X2dyb3VwcyAwDQoJCQkJdWludCBtYXhfbXVsdGlsb2dpbnNfcGVyX3VzZXIgMA0KCQkJCXVpbnQgbWF4X3Nlc3Npb25zIDANCgkJCQl1aW50IG1heF9zZXNzaW9uc19icmlkZ2UgMA0KCQkJCXVpbnQgbWF4X3Nlc3Npb25zX2NsaWVudCAwDQoJCQkJdWludCBtYXhfc2Vzc2lvbnNfY2xpZW50X2JyaWRnZV9hcHBseSAwDQoJCQkJdWludCBtYXhfdXNlcnMgMA0KCQkJCXVpbnQgbm9fYWNjZXNzX2xpc3RfaW5jbHVkZV9maWxlIDANCgkJCQl1aW50IG5vX2Nhc2NhZGUgMA0KCQkJCXVpbnQgbm9fY2hhbmdlX2FjY2Vzc19jb250cm9sX2xpc3QgMA0KCQkJCXVpbnQgbm9fY2hhbmdlX2FjY2Vzc19saXN0IDANCgkJCQl1aW50IG5vX2NoYW5nZV9hZG1pbl9wYXNzd29yZCAwDQoJCQkJdWludCBub19jaGFuZ2VfY2VydF9saXN0IDANCgkJCQl1aW50IG5vX2NoYW5nZV9jcmxfbGlzdCAwDQoJCQkJdWludCBub19jaGFuZ2VfZ3JvdXBzIDANCgkJCQl1aW50IG5vX2NoYW5nZV9sb2dfY29uZmlnIDANCgkJCQl1aW50IG5vX2NoYW5nZV9sb2dfc3dpdGNoX3R5cGUgMA0KCQkJCXVpbnQgbm9fY2hhbmdlX21zZyAwDQoJCQkJdWludCBub19jaGFuZ2VfdXNlcnMgMA0KCQkJCXVpbnQgbm9fZGVsYXlfaml0dGVyX3BhY2tldF9sb3NzIDANCgkJCQl1aW50IG5vX2RlbGV0ZV9pcHRhYmxlIDANCgkJCQl1aW50IG5vX2RlbGV0ZV9tYWN0YWJsZSAwDQoJCQkJdWludCBub19kaXNjb25uZWN0X3Nlc3Npb24gMA0KCQkJCXVpbnQgbm9fZW51bV9zZXNzaW9uIDANCgkJCQl1aW50IG5vX29mZmxpbmUgMA0KCQkJCXVpbnQgbm9fb25saW5lIDANCgkJCQl1aW50IG5vX3F1ZXJ5X3Nlc3Npb24gMA0KCQkJCXVpbnQgbm9fcmVhZF9sb2dfZmlsZSAwDQoJCQkJdWludCBub19zZWN1cmVuYXQgMA0KCQkJCXVpbnQgbm9fc2VjdXJlbmF0X2VuYWJsZWRoY3AgMA0KCQkJCXVpbnQgbm9fc2VjdXJlbmF0X2VuYWJsZW5hdCAwDQoJCQl9DQoJCQlkZWNsYXJlIENhc2NhZGVMaXN0DQoJCQl7DQoJCQl9DQoJCQlkZWNsYXJlIExvZ1NldHRpbmcNCgkJCXsNCgkJCQl1aW50IFBhY2tldExvZ1N3aXRjaFR5cGUgNA0KCQkJCXVpbnQgUEFDS0VUX0xPR19BUlAgMA0KCQkJCXVpbnQgUEFDS0VUX0xPR19ESENQIDENCgkJCQl1aW50IFBBQ0tFVF9MT0dfRVRIRVJORVQgMA0KCQkJCXVpbnQgUEFDS0VUX0xPR19JQ01QIDANCgkJCQl1aW50IFBBQ0tFVF9MT0dfSVAgMA0KCQkJCXVpbnQgUEFDS0VUX0xPR19UQ1AgMA0KCQkJCXVpbnQgUEFDS0VUX0xPR19UQ1BfQ09OTiAxDQoJCQkJdWludCBQQUNLRVRfTE9HX1VEUCAwDQoJCQkJYm9vbCBTYXZlUGFja2V0TG9nIGZhbHNlDQoJCQkJYm9vbCBTYXZlU2VjdXJpdHlMb2cgdHJ1ZQ0KCQkJCXVpbnQgU2VjdXJpdHlMb2dTd2l0Y2hUeXBlIDQNCgkJCX0NCgkJCWRlY2xhcmUgTWVzc2FnZQ0KCQkJew0KCQkJfQ0KCQkJZGVjbGFyZSBPcHRpb24NCgkJCXsNCgkJCQl1aW50IEFjY2Vzc0xpc3RJbmNsdWRlRmlsZUNhY2hlTGlmZXRpbWUgMzANCgkJCQl1aW50IEFkanVzdFRjcE1zc1ZhbHVlIDANCgkJCQlib29sIEFwcGx5SVB2NEFjY2Vzc0xpc3RPbkFycFBhY2tldCBmYWxzZQ0KCQkJCWJvb2wgQXNzaWduVkxhbklkQnlSYWRpdXNBdHRyaWJ1dGUgZmFsc2UNCgkJCQlib29sIEJyb2FkY2FzdExpbWl0ZXJTdHJpY3RNb2RlIGZhbHNlDQoJCQkJdWludCBCcm9hZGNhc3RTdG9ybURldGVjdGlvblRocmVzaG9sZCAwDQoJCQkJdWludCBDbGllbnRNaW5pbXVtUmVxdWlyZWRCdWlsZCAwDQoJCQkJYm9vbCBEZW55QWxsUmFkaXVzTG9naW5XaXRoTm9WbGFuQXNzaWduIGZhbHNlDQoJCQkJdWludCBEZXRlY3REb3JtYW50U2Vzc2lvbkludGVydmFsIDANCgkJCQlib29sIERpc2FibGVBZGp1c3RUY3BNc3MgZmFsc2UNCgkJCQlib29sIERpc2FibGVDaGVja01hY09uTG9jYWxCcmlkZ2UgZmFsc2UNCgkJCQlib29sIERpc2FibGVDb3JyZWN0SXBPZmZsb2FkQ2hlY2tzdW0gZmFsc2UNCgkJCQlib29sIERpc2FibGVIdHRwUGFyc2luZyBmYWxzZQ0KCQkJCWJvb2wgRGlzYWJsZUlQUGFyc2luZyBmYWxzZQ0KCQkJCWJvb2wgRGlzYWJsZUlwUmF3TW9kZVNlY3VyZU5BVCBmYWxzZQ0KCQkJCWJvb2wgRGlzYWJsZUtlcm5lbE1vZGVTZWN1cmVOQVQgZmFsc2UNCgkJCQlib29sIERpc2FibGVVZHBBY2NlbGVyYXRpb24gZmFsc2UNCgkJCQlib29sIERpc2FibGVVZHBGaWx0ZXJGb3JMb2NhbEJyaWRnZU5pYyBmYWxzZQ0KCQkJCWJvb2wgRGlzYWJsZVVzZXJNb2RlU2VjdXJlTkFUIGZhbHNlDQoJCQkJYm9vbCBEb05vdFNhdmVIZWF2eVNlY3VyaXR5TG9ncyBmYWxzZQ0KCQkJCWJvb2wgRHJvcEFycEluUHJpdmFjeUZpbHRlck1vZGUgdHJ1ZQ0KCQkJCWJvb2wgRHJvcEJyb2FkY2FzdHNJblByaXZhY3lGaWx0ZXJNb2RlIHRydWUNCgkJCQlib29sIEZpbHRlckJQRFUgZmFsc2UNCgkJCQlib29sIEZpbHRlcklQdjQgZmFsc2UNCgkJCQlib29sIEZpbHRlcklQdjYgZmFsc2UNCgkJCQlib29sIEZpbHRlck5vbklQIGZhbHNlDQoJCQkJYm9vbCBGaWx0ZXJPU1BGIGZhbHNlDQoJCQkJYm9vbCBGaWx0ZXJQUFBvRSBmYWxzZQ0KCQkJCXVpbnQgRmxvb2RpbmdTZW5kUXVldWVCdWZmZXJRdW90YSAzMzU1NDQzMg0KCQkJCWJvb2wgTWFuYWdlT25seUxvY2FsVW5pY2FzdElQdjYgdHJ1ZQ0KCQkJCWJvb2wgTWFuYWdlT25seVByaXZhdGVJUCB0cnVlDQoJCQkJdWludCBNYXhMb2dnZWRQYWNrZXRzUGVyTWludXRlIDANCgkJCQl1aW50IE1heFNlc3Npb24gMA0KCQkJCWJvb2wgTm9BcnBQb2xsaW5nIGZhbHNlDQoJCQkJYm9vbCBOb0RoY3BQYWNrZXRMb2dPdXRzaWRlSHViIHRydWUNCgkJCQlib29sIE5vRW51bSBmYWxzZQ0KCQkJCWJvb2wgTm9JcFRhYmxlIGZhbHNlDQoJCQkJYm9vbCBOb0lQdjRQYWNrZXRMb2cgZmFsc2UNCgkJCQlib29sIE5vSVB2NkFkZHJQb2xsaW5nIGZhbHNlDQoJCQkJYm9vbCBOb0lQdjZEZWZhdWx0Um91dGVySW5SQVdoZW5JUHY2IHRydWUNCgkJCQlib29sIE5vSVB2NlBhY2tldExvZyBmYWxzZQ0KCQkJCWJvb2wgTm9Mb29rQlBEVUJyaWRnZUlkIGZhbHNlDQoJCQkJYm9vbCBOb01hY0FkZHJlc3NMb2cgdHJ1ZQ0KCQkJCWJvb2wgTm9NYW5hZ2VWbGFuSWQgZmFsc2UNCgkJCQlib29sIE5vUGh5c2ljYWxJUE9uUGFja2V0TG9nIGZhbHNlDQoJCQkJYm9vbCBOb1NwaW5Mb2NrRm9yUGFja2V0RGVsYXkgZmFsc2UNCgkJCQlib29sIFJlbW92ZURlZkd3T25EaGNwRm9yTG9jYWxob3N0IHRydWUNCgkJCQl1aW50IFJlcXVpcmVkQ2xpZW50SWQgMA0KCQkJCXVpbnQgU2VjdXJlTkFUX01heERuc1Nlc3Npb25zUGVySXAgMA0KCQkJCXVpbnQgU2VjdXJlTkFUX01heEljbXBTZXNzaW9uc1BlcklwIDANCgkJCQl1aW50IFNlY3VyZU5BVF9NYXhUY3BTZXNzaW9uc1BlcklwIDANCgkJCQl1aW50IFNlY3VyZU5BVF9NYXhUY3BTeW5TZW50UGVySXAgMA0KCQkJCXVpbnQgU2VjdXJlTkFUX01heFVkcFNlc3Npb25zUGVySXAgMA0KCQkJCWJvb2wgU2VjdXJlTkFUX1JhbmRvbWl6ZUFzc2lnbklwIGZhbHNlDQoJCQkJYm9vbCBTdXBwcmVzc0NsaWVudFVwZGF0ZU5vdGlmaWNhdGlvbiBmYWxzZQ0KCQkJCWJvb2wgVXNlSHViTmFtZUFzRGhjcFVzZXJDbGFzc09wdGlvbiBmYWxzZQ0KCQkJCWJvb2wgVXNlSHViTmFtZUFzUmFkaXVzTmFzSWQgZmFsc2UNCgkJCQlzdHJpbmcgVmxhblR5cGVJZCAweDgxMDANCgkJCQlib29sIFlpZWxkQWZ0ZXJTdG9yZVBhY2tldCBmYWxzZQ0KCQkJfQ0KCQkJZGVjbGFyZSBTZWN1cmVOQVQNCgkJCXsNCgkJCQlib29sIERpc2FibGVkIGZhbHNlDQoJCQkJYm9vbCBTYXZlTG9nIGZhbHNlDQoNCgkJCQlkZWNsYXJlIFZpcnR1YWxEaGNwU2VydmVyDQoJCQkJew0KCQkJCQlzdHJpbmcgRGhjcERuc1NlcnZlckFkZHJlc3MgOC44LjguOA0KCQkJCQlzdHJpbmcgRGhjcERuc1NlcnZlckFkZHJlc3MyIDguOC40LjQNCgkJCQkJc3RyaW5nIERoY3BEb21haW5OYW1lICQNCgkJCQkJYm9vbCBEaGNwRW5hYmxlZCB0cnVlDQoJCQkJCXVpbnQgRGhjcEV4cGlyZVRpbWVTcGFuIDcyMDANCgkJCQkJc3RyaW5nIERoY3BHYXRld2F5QWRkcmVzcyAxOTIuMTY4LjIzMy4xDQoJCQkJCXN0cmluZyBEaGNwTGVhc2VJUEVuZCAxOTIuMTY4LjIzMy4yMDANCgkJCQkJc3RyaW5nIERoY3BMZWFzZUlQU3RhcnQgMTkyLjE2OC4yMzMuMTANCgkJCQkJc3RyaW5nIERoY3BQdXNoUm91dGVzICQNCgkJCQkJc3RyaW5nIERoY3BTdWJuZXRNYXNrIDI1NS4yNTUuMjU1LjANCgkJCQl9DQoJCQkJZGVjbGFyZSBWaXJ0dWFsSG9zdA0KCQkJCXsNCgkJCQkJc3RyaW5nIFZpcnR1YWxIb3N0SXAgMTkyLjE2OC4yMzMuMQ0KCQkJCQlzdHJpbmcgVmlydHVhbEhvc3RJcFN1Ym5ldE1hc2sgMjU1LjI1NS4yNTUuMA0KCQkJCX0NCgkJCQlkZWNsYXJlIFZpcnR1YWxSb3V0ZXINCgkJCQl7DQoJCQkJCWJvb2wgTmF0RW5hYmxlZCB0cnVlDQoJCQkJCXVpbnQgTmF0TXR1IDE1MDANCgkJCQkJdWludCBOYXRUY3BUaW1lb3V0IDYwMA0KCQkJCQl1aW50IE5hdFVkcFRpbWVvdXQgNjANCgkJCQl9DQoJCQl9DQoJCQlkZWNsYXJlIFNlY3VyaXR5QWNjb3VudERhdGFiYXNlDQoJCQl7DQoJCQkJZGVjbGFyZSBDZXJ0TGlzdA0KCQkJCXsNCgkJCQl9DQoJCQkJZGVjbGFyZSBDcmxMaXN0DQoJCQkJew0KCQkJCX0NCgkJCQlkZWNsYXJlIEdyb3VwTGlzdA0KCQkJCXsNCgkJCQl9DQoJCQkJZGVjbGFyZSBJUEFjY2Vzc0NvbnRyb2xMaXN0DQoJCQkJew0KCQkJCX0NCgkJCQlkZWNsYXJlIFVzZXJMaXN0DQoJCQkJew0KCQkJCX0NCgkJCX0NCgkJCWRlY2xhcmUgVHJhZmZpYw0KCQkJew0KCQkJfQ0KCQl9DQoJfQ0KCWRlY2xhcmUgVmlydHVhbExheWVyM1N3aXRjaExpc3QNCgl7DQoJfQ0KfQ0K'

while [[ $# -ge 1 ]]; do
  case $1 in
    -a)
      shift
      ADMIN=`echo "$1" |sed 's/[[:space:]]//g'`
      shift
      ;;
    -u)
      shift
      USER=`echo "$1" |sed 's/[[:space:]]//g'`
      shift
      ;;
    -p)
      shift
      PASSWD=`echo "$1" |sed 's/[[:space:]]//g'`
      shift
      ;;
    -url)
      shift
      SoftEtherURL=`echo "$1" |sed 's/[[:space:]]//g'`
      shift
      ;;
    -ver)
      shift
      SoftEtherVersion=`echo "$1" |sed 's/[[:space:]]//g'`
      shift
      ;;
    *)
      echo -ne " Usage:\n\tbash $(basename $0)\t-a [AdminPasswd] -u [User] -p [Passwd]\n"
      exit 1;
      ;;
    esac
  done

[ -n "$ADMIN" ] || ADMIN="empty"
[ -n "$USER" ] || USER="vpn"
[ -n "$PASSWD" ] || PASSWD="vpn"

case `uname -m` in aarch64|arm64) ARCH="arm64";; x86|i386|i686) ARCH="i386";; x86_64|amd64) ARCH="amd64";; *) ARCH="";; esac
[ -n "$ARCH" ] || exit 1

[ ! -n "$SoftEtherURL" ] && [ "$ARCH" == "arm64" ] && SoftEtherURL="http://www.softether-download.com/files/softether/${SoftEtherVersion}-tree/Linux/SoftEther_VPN_Server/64bit_-_ARM_64bit/softether-vpnserver-${SoftEtherVersion}-linux-arm64-64bit.tar.gz";
[ ! -n "$SoftEtherURL" ] && [ "$ARCH" == "amd64" ] && SoftEtherURL="http://www.softether-download.com/files/softether/${SoftEtherVersion}-tree/Linux/SoftEther_VPN_Server/64bit_-_Intel_x64_or_AMD64/softether-vpnserver-${SoftEtherVersion}-linux-x64-64bit.tar.gz";
[ ! -n "$SoftEtherURL" ] && [ "$ARCH" == "i386" ] && SoftEtherURL="http://www.softether-download.com/files/softether/${SoftEtherVersion}-tree/Linux/SoftEther_VPN_Server/32bit_-_Intel_x86/softether-vpnserver-${SoftEtherVersion}-linux-x86-32bit.tar.gz";
[ ! -n "$SoftEtherURL" ] && exit 1

wget --no-check-certificate --no-cache -4 -qO "/tmp/softether.tar.gz" "${SoftEtherURL}"
[ $? -eq 0 ] || exit 1

kill -9 `ps -C "vpnserver" -o pid=` >/dev/null 2>&1
rm -rf /tmp/vpnserver
rm -rf /etc/softether
mkdir -p /etc/softether
echo "${SoftEtherConfig}" |base64 -d >/etc/softether/vpn_server.config

tar -zvxf /tmp/softether.tar.gz -C /tmp
cd /tmp/vpnserver
# make i_read_and_agree_the_license_agreement
make main
[ $? -eq 0 ] || exit 1


[ -f /tmp/vpnserver/vpnserver ] && cp -rf /tmp/vpnserver/vpnserver /etc/softether
[ -f /tmp/vpnserver/vpncmd ] && cp -rf /tmp/vpnserver/vpncmd /etc/softether
[ -f /tmp/vpnserver/hamcore.se2 ] && cp -rf /tmp/vpnserver/hamcore.se2 /etc/softether
[ -f /etc/softether/vpnserver ] && [ -f /etc/softether/vpncmd ] && [ -f /tmp/vpnserver/hamcore.se2 ] || exit 1
chmod -R 755 /etc/softether


if [ -f /etc/crontab ]; then
  sed -i '/vpnserver/d' /etc/crontab
  while [ -z "$(sed -n '$p' /etc/crontab)" ]; do sed -i '$d' /etc/crontab; done
  sed -i "\$a\@reboot root /etc/softether/vpnserver start >>/dev/null 2>&1 &\n\n\n" /etc/crontab
fi

/etc/softether/vpnserver start

while true; do /etc/softether/vpncmd 127.0.0.1:5555 /SERVER /PASSWORD:empty /CMD:About >/dev/null 2>&1; [ $? -eq 0 ] && break; echo "Waiting vpnserver ..."; sleep 1; done

/etc/softether/vpncmd 127.0.0.1:5555 /SERVER /PASSWORD:empty /HUB:DEFAULT /CMD:UserCreate "$USER" /GROUP: /REALNAME: /NOTE:
/etc/softether/vpncmd 127.0.0.1:5555 /SERVER /PASSWORD:empty /HUB:DEFAULT /CMD:UserPasswordSet "$USER" /PASSWORD:"$PASSWD"

/etc/softether/vpncmd 127.0.0.1:5555 /SERVER /PASSWORD:empty /HUB:DEFAULT /CMD:SetHubPassword "$ADMIN"
/etc/softether/vpncmd 127.0.0.1:5555 /SERVER /PASSWORD:empty /CMD:ServerPasswordSet "$ADMIN"

/etc/softether/vpnserver stop
/etc/softether/vpnserver start

